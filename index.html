<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¹¼å„¿å½¢çŠ¶è®¤çŸ¥æŒ‘æˆ˜</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --primary-blue: #3b82f6;
        }
        body { 
            margin: 0; background: var(--bg-color); font-family: 'PingFang SC', sans-serif; 
            display: flex; flex-direction: column; align-items: center; overflow: hidden; touch-action: none;
        }
        h1 { color: #1e293b; margin: 20px 0 10px; font-size: 22px; }
        
        /* éš¾åº¦æ§åˆ¶æ  */
        .controls { margin-bottom: 20px; display: flex; gap: 10px; }
        button { 
            padding: 8px 16px; border: none; border-radius: 20px; background: white; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; font-size: 14px;
        }
        button.active { background: var(--primary-blue); color: white; }

        .game-area {
            position: relative; width: 90vw; height: 70vh; max-width: 600px;
            background: white; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            padding: 20px; display: flex; flex-direction: column; justify-content: space-between;
        }

        /* ç›®æ ‡åŒºåŸŸå’Œå½¢çŠ¶åŒºåŸŸ */
        .zone { 
            display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; 
            min-height: 100px; align-content: center;
        }

        /* å½¢çŠ¶åŸºç¡€æ ·å¼ */
        .shape { 
            width: 55px; height: 55px; position: relative; transition: transform 0.1s;
            display: flex; align-items: center; justify-content: center;
        }
        .shape-inner { width: 100%; height: 100%; }
        
        /* å„ç§å‡ ä½•å›¾å½¢ */
        .type-circle { border-radius: 50%; }
        .type-square { border-radius: 8px; }
        .type-triangle { 
            width: 0; height: 0; border-left: 28px solid transparent; 
            border-right: 28px solid transparent; border-bottom: 55px solid; 
        }

        /* ç›®æ ‡æ¡†æ ·å¼ */
        .target { 
            width: 65px; height: 65px; border: 3px dashed #e2e8f0; 
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            background: #fdfdfd; transition: all 0.3s;
        }
        .target.matched { border: 3px solid #10b981; background: #f0fdf4; transform: scale(1.05); }

        .dragging { opacity: 0.8; transform: scale(1.2); z-index: 100; pointer-events: none; }
    </style>
</head>
<body>

    <h1>æ‰¾æ‰¾çœ‹ï¼Œå®ƒä»¬åœ¨å“ªï¼Ÿ</h1>
    
    <div class="controls">
        <button onclick="startGame(3)" id="btn-3" class="active">ç®€å• (3)</button>
        <button onclick="startGame(5)" id="btn-5">ä¸­ç­‰ (5)</button>
        <button onclick="startGame(8)" id="btn-8">æŒ‘æˆ˜ (8)</button>
    </div>

    <div class="game-area" id="gameArea">
        <div class="zone" id="targetZone"></div>
        <hr style="width: 80%; border: 0; border-top: 1px solid #f1f5f9;">
        <div class="zone" id="sourceZone"></div>
    </div>

    <script>
        const shapesConfig = [
            { type: 'circle', color: '#ef4444' },
            { type: 'square', color: '#3b82f6' },
            { type: 'triangle', color: '#22c55e' },
            { type: 'square', color: '#f59e0b' }, // æ©™è‰²æ­£æ–¹å½¢
            { type: 'circle', color: '#8b5cf6' }, // ç´«è‰²åœ†å½¢
            { type: 'triangle', color: '#ec4899' }, // ç²‰è‰²ä¸‰è§’å½¢
            { type: 'square', color: '#06b6d4' }, // é’è‰²æ­£æ–¹å½¢
            { type: 'circle', color: '#475569' }  // ç°è‰²åœ†å½¢
        ];

        let activeElement = null;
        let offset = { x: 0, y: 0 };
        let initialPos = { x: 0, y: 0 };

        function startGame(count) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${count}`).classList.add('active');

            const targetZone = document.getElementById('targetZone');
            const sourceZone = document.getElementById('sourceZone');
            targetZone.innerHTML = '';
            sourceZone.innerHTML = '';

            // æˆªå–å¯¹åº”æ•°é‡çš„å½¢çŠ¶é…ç½®
            const currentShapes = shapesConfig.slice(0, count);
            
            // æ¸²æŸ“ç›®æ ‡æ¡†ï¼ˆæ‰“ä¹±é¡ºåºï¼‰
            [...currentShapes].sort(() => Math.random() - 0.5).forEach(conf => {
                const target = document.createElement('div');
                target.className = 'target';
                target.dataset.match = `${conf.type}-${conf.color}`;
                targetZone.appendChild(target);
            });

            // æ¸²æŸ“å¾…é€‰å½¢çŠ¶
            currentShapes.forEach((conf, index) => {
                const shape = document.createElement('div');
                shape.className = `shape drag-item`;
                shape.id = `shape-${index}`;
                shape.dataset.id = `${conf.type}-${conf.color}`;
                
                const inner = document.createElement('div');
                inner.className = `shape-inner type-${conf.type}`;
                if(conf.type === 'triangle') {
                    inner.style.borderBottomColor = conf.color;
                } else {
                    inner.style.backgroundColor = conf.color;
                }
                
                shape.appendChild(inner);
                sourceZone.appendChild(shape);

                // ç»‘å®šè§¦æ‘¸äº‹ä»¶
                shape.ontouchstart = handleStart;
            });
        }

        function handleStart(e) {
            e.preventDefault();
            activeElement = e.currentTarget;
            const touch = e.touches[0];
            const rect = activeElement.getBoundingClientRect();
            
            // è®°å½•åˆå§‹ä½ç½®ä»¥ä¾¿å›å¼¹
            initialPos = { x: activeElement.offsetLeft, y: activeElement.offsetTop };
            // è®¡ç®—æ‰‹æŒ‡åœ¨ç‰©ä½“å†…çš„åç§»é‡
            offset = { x: touch.clientX - rect.left, y: touch.clientY - rect.top };
            
            activeElement.classList.add('dragging');
            activeElement.style.position = 'fixed';
            moveAt(touch.clientX, touch.clientY);

            document.ontouchmove = (e) => moveAt(e.touches[0].clientX, e.touches[0].clientY);
            document.ontouchend = handleEnd;
        }

        function moveAt(pageX, pageY) {
            if (!activeElement) return;
            activeElement.style.left = pageX - offset.x + 'px';
            activeElement.style.top = pageY - offset.y + 'px';
        }

        function handleEnd(e) {
            if (!activeElement) return;
            const touch = e.changedTouches[0];
            const dropID = activeElement.dataset.id;
            
            // å¯»æ‰¾åŒ¹é…çš„ç›®æ ‡æ¡†
            const targets = document.querySelectorAll('.target');
            let isMatched = false;

            targets.forEach(target => {
                const rect = target.getBoundingClientRect();
                // ç¢°æ’æ£€æµ‹
                if (touch.clientX > rect.left && touch.clientX < rect.right &&
                    touch.clientY > rect.top && touch.clientY < rect.bottom) {
                    
                    if (target.dataset.match === dropID && !target.classList.contains('matched')) {
                        // åŒ¹é…æˆåŠŸ
                        target.classList.add('matched');
                        target.appendChild(activeElement);
                        
                        // é‡ç½®ä½ç½®åˆ°ç›®æ ‡æ¡†æ­£ä¸­å¿ƒ
                        activeElement.style.position = 'static';
                        activeElement.classList.remove('dragging');
                        activeElement.ontouchstart = null; // ç¦æ­¢å†æ¬¡æ‹–åŠ¨
                        isMatched = true;
                    }
                }
            });

            if (!isMatched) {
                // å›åˆ°åŸåœ°
                activeElement.style.position = 'static';
                activeElement.classList.remove('dragging');
            }

            activeElement = null;
            document.ontouchmove = null;
            checkWin();
        }

        function checkWin() {
            const matched = document.querySelectorAll('.target.matched').length;
            const total = document.querySelectorAll('.target').length;
            if (matched === total) {
                setTimeout(() => {
                    alert('ğŸ‰ å¤ªæ£’äº†ï¼æ‰€æœ‰çš„å½¢çŠ¶éƒ½æ‰¾å¯¹å•¦ï¼');
                    startGame(total);
                }, 300);
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        startGame(3);
    </script>
</body>
</html>
