<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¹¼å„¿è®¤çŸ¥æŒ‘æˆ˜ - 8ç§å½¢çŠ¶ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #f0f4f8;
            --shadow-color: #d1d5db;
        }
        body { 
            margin: 0; padding: 0; background: var(--bg-color); 
            font-family: sans-serif; display: flex; flex-direction: column; 
            align-items: center; height: 100vh; overflow: hidden; touch-action: none;
        }

        .controls { 
            height: 12vh; display: flex; align-items: center; gap: 15px; 
        }
        button { 
            padding: 10px 25px; border: none; border-radius: 20px; background: white; 
            box-shadow: 0 4px 0 #cbd5e1; font-size: 18px; font-weight: bold; color: #475569;
            transition: all 0.1s;
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px 0 #cbd5e1; }
        button.active { background: #6366f1; color: white; box-shadow: 0 4px 0 #4338ca; }

        .game-area {
            width: 95vw; height: 85vh; max-width: 800px;
            display: flex; flex-direction: column; gap: 10px;
        }

        .zone {
            flex: 1; display: flex; flex-wrap: wrap; justify-content: center;
            align-content: center; gap: 15px; padding: 10px;
            background: rgba(255,255,255,0.4); border-radius: 20px;
        }

        /* å½¢çŠ¶å®¹å™¨ */
        .shape-item { 
            width: 75px; height: 75px; display: flex; align-items: center; justify-content: center;
        }
        svg { width: 65px; height: 65px; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1)); }

        /* ç›®æ ‡æ¡† */
        .target-box {
            width: 85px; height: 85px; border: 3px dashed var(--shadow-color);
            border-radius: 15px; display: flex; align-items: center; justify-content: center;
            background: #fff; transition: all 0.3s;
        }
        .target-box.matched { border: 3px solid #10b981; background: #ecfdf5; transform: scale(1.05); }
        .target-box svg { opacity: 0.15; filter: grayscale(1); }
        .target-box.matched svg { opacity: 1; filter: none; }

        /* æ‹–æ‹½æ€ */
        .dragging { position: fixed !important; z-index: 1000; transform: scale(1.2); pointer-events: none; }
    </style>
</head>
<body>

    <div class="controls">
        <button onclick="initGame(3)" id="btn-3" class="active">ç®€å•</button>
        <button onclick="initGame(5)" id="btn-5">ä¸­ç­‰</button>
        <button onclick="initGame(8)" id="btn-8">æŒ‘æˆ˜</button>
    </div>

    <div class="game-area">
        <div class="zone" id="targetZone"></div>
        <div class="zone" id="sourceZone"></div>
    </div>

    <script>
        // å®šä¹‰8ç§ä¸åŒçš„å½¢çŠ¶æ•°æ® (SVG Path)
        const SHAPE_LIBRARY = [
            { name: 'circle', path: 'M32,64A32,32,0,1,0,32,0,32,32,0,1,0,32,64Z' },
            { name: 'square', path: 'M4,4H60V60H4Z' },
            { name: 'triangle', path: 'M32,4 L60,60 L4,60 Z' },
            { name: 'star', path: 'M32,4 L40,24 L60,24 L44,38 L50,60 L32,46 L14,60 L20,38 L4,24 L24,24 Z' },
            { name: 'pentagon', path: 'M32,4 L60,24 L50,58 L14,58 L4,24 Z' },
            { name: 'heart', path: 'M32,58 L28,54 C12,40 4,32 4,22 A12,12 0 0 1 28,10 L32,14 L36,10 A12,12 0 0 1 60,22 C60,32 52,40 36,54 Z' },
            { name: 'moon', path: 'M32,4 A28,28 0 1 1 12,50 A22,22 0 1 0 32,4 Z' },
            { name: 'trapezoid', path: 'M16,10 L48,10 L60,54 L4,54 Z' }
        ];

        const COLORS = ['#FF6B6B', '#4D96FF', '#6BCB77', '#FFD93D', '#92A9BD', '#F473B9', '#646464', '#FF8E00'];

        let activeEl = null;
        let offset = { x: 0, y: 0 };

        function createSVG(shape, color) {
            return `
                <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                    <path d="${shape.path}" fill="${color}" />
                </svg>
            `;
        }

        function initGame(count) {
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${count}`).classList.add('active');

            const targetZone = document.getElementById('targetZone');
            const sourceZone = document.getElementById('sourceZone');
            targetZone.innerHTML = '';
            sourceZone.innerHTML = '';

            // 1. æ ¸å¿ƒä¿®å¤ï¼šä»å½¢çŠ¶åº“ä¸­éšæœºæŠ½å– N ä¸ªä¸é‡å¤çš„å½¢çŠ¶
            let selectedShapes = [...SHAPE_LIBRARY].sort(() => Math.random() - 0.5).slice(0, count);
            // 2. é¢œè‰²ä¹Ÿè¿›è¡Œæ´—ç‰Œ
            let selectedColors = [...COLORS].sort(() => Math.random() - 0.5);

            let gameData = selectedShapes.map((shape, i) => ({
                ...shape,
                color: selectedColors[i],
                id: `shape-${i}`
            }));

            // 3. æ¸²æŸ“ç›®æ ‡ï¼ˆå½±å­ï¼‰- é¡ºåºæ‰“ä¹±
            [...gameData].sort(() => Math.random() - 0.5).forEach(item => {
                const box = document.createElement('div');
                box.className = 'target-box';
                box.dataset.matchId = item.id;
                box.innerHTML = createSVG(item, '#333');
                targetZone.appendChild(box);
            });

            // 4. æ¸²æŸ“æºå½¢çŠ¶
            gameData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'shape-item drag-item';
                div.dataset.id = item.id;
                div.innerHTML = createSVG(item, item.color);
                div.ontouchstart = handleTouchStart;
                sourceZone.appendChild(div);
            });
        }

        function handleTouchStart(e) {
            e.preventDefault();
            activeEl = e.currentTarget;
            const touch = e.touches[0];
            const rect = activeEl.getBoundingClientRect();
            
            offset = { x: touch.clientX - rect.left, y: touch.clientY - rect.top };
            activeEl.classList.add('dragging');
            moveAt(touch.clientX, touch.clientY);

            document.ontouchmove = (ev) => moveAt(ev.touches[0].clientX, ev.touches[0].clientY);
            document.ontouchend = handleTouchEnd;
        }

        function moveAt(x, y) {
            if(!activeEl) return;
            activeEl.style.left = (x - offset.x) + 'px';
            activeEl.style.top = (y - offset.y) + 'px';
        }

        function handleTouchEnd(e) {
            if(!activeEl) return;
            const touch = e.changedTouches[0];
            const targets = document.querySelectorAll('.target-box');
            let matched = false;

            targets.forEach(target => {
                if(target.classList.contains('matched')) return;
                const rect = target.getBoundingClientRect();
                
                if(touch.clientX > rect.left && touch.clientX < rect.right &&
                   touch.clientY > rect.top && touch.clientY < rect.bottom) {
                    
                    if(target.dataset.matchId === activeEl.dataset.id) {
                        target.classList.add('matched');
                        activeEl.remove();
                        matched = true;
                    }
                }
            });

            if(!matched) {
                activeEl.classList.remove('dragging');
                activeEl.style.position = 'static';
            }

            activeEl = null;
            document.ontouchmove = null;
            checkWin();
        }

        function checkWin() {
            const matchedCount = document.querySelectorAll('.target-box.matched').length;
            const total = document.querySelectorAll('.target-box').length;
            if(matchedCount === total) {
                setTimeout(() => {
                    alert('ğŸ‰ æ£’æäº†ï¼å…¨å¯¹äº†ï¼');
                    initGame(total);
                }, 400);
            }
        }

        initGame(3);
    </script>
</body>
</html>
